    <div id="wrapper">

      <div id="map"></div>
      <div id="filter">
        <%= render 'filter' %>

      </div>
      <div id="search">
        <form class="form-inline">
          <input type="Radius" placeholder="Enter KM" class="form-control km-entry" style="width: 100px;">
          <input type="Address" placeholder="Point or Enter Address" class="form-control" style="width: 250px;">
          <input type="submit" value="Search" class="btn btn-primary btn-bordered btn-bordered-primary" style="background-color: blue; border: none;">
        </form>

      </div>
      <div id="results">
        <div id="results-button">
        </div>

      </div>
      <!-- put in link to the next page -->
    </div>
    <!-- end of wrapper -->

    <% content_for(:after_js) do %>
      <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?language=en&key=#{ENV['GOOGLE_API_BROWSER_KEY']}&callback=initMap" %>
      <script>
        var markers = []

        var map;

        function initMap(callback) {
            map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: new google.maps.LatLng(<%= @requests.first.latitude %>, <%= @requests.first.longitude %>),
            mapTypeId: 'roadmap'
          });

          map.markers = [];
          map.circles = [];
          // var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
          var riceImage = {
            url: '<%= asset_path('rice_image.png') %>',
            scaledSize: new google.maps.Size(40, 40),
            anchor: new google.maps.Point(20, 20)

          }

          var riceImage = {
            url: '<%= asset_path('rice_image.png') %>',
            scaledSize: new google.maps.Size(40, 40),
            anchor: new google.maps.Point(20, 20)

          }

          var riceImage = {
            url: '<%= asset_path('rice_image.png') %>',
            scaledSize: new google.maps.Size(40, 40),
            anchor: new google.maps.Point(20, 20)

          }

          var riceImage = {
            url: '<%= asset_path('rice_image.png') %>',
            scaledSize: new google.maps.Size(40, 40),
            anchor: new google.maps.Point(20, 20)

          }

          var riceImage = {
            url: '<%= asset_path('rice_image.png') %>',
            scaledSize: new google.maps.Size(40, 40),
            anchor: new google.maps.Point(20, 20)

          }

          var riceImage = {
            url: '<%= asset_path('rice_image.png') %>',
            scaledSize: new google.maps.Size(40, 40),
            anchor: new google.maps.Point(20, 20)

          }

          var fireImage = {
            url: '<%= asset_path('fire_image.png') %>',
            scaledSize: new google.maps.Size(30, 30),
            anchor: new google.maps.Point(15, 15)
          }

          var medicalImage = {
            url: '<%= asset_path('medical_image.png') %>',
            scaledSize: new google.maps.Size(30, 30),
            anchor: new google.maps.Point(20, 20)

          }
          var icons = {
            relief: {
              icon: riceImage
            },
            relief: {
              icon: riceImage
            },
            relief: {
              icon: riceImage
            },
            relief: {
              icon: riceImage
            },
            relief: {
              icon: riceImage
            },
            relief: {
              icon: riceImage
            },

            // supplies icons
            //

            relief: {
              icon: riceImage
            },
            relief: {
              icon: riceImage
            },
            relief: {
              icon: riceImage
            },

            // volunteers icons


            fire: {
              icon: fireImage
            },
            medical: {
              icon: medicalImage
            },
            rescue: {
              icon: medicalImage
            }
            // library: {
            //   icon: iconBase + 'info-i_maps.png'
            // }
          };

        var requests = [
          <% @requests.each do |request| %>
        {
          position: new google.maps.LatLng(<%= request.latitude %>, <%= request.longitude %>),
          category: '<%= request.category %>', id: <%= request.id %>, user_id: <%= request.user_id %>, address: '<%= request.address %>', priority: '<%= request.priority %>', status: '<%= request.status %>', created_at: '<%= request.created_at %>', updated_at: '<%= request.updated_at %>'
        },
          <% end %>
          ];
          // end of requests assignment
          function createCircle(marker) {
            var circle = new google.maps.Circle({
                center: marker.position,
                map:map,
                radius:50,
                strokeColor: "red",
                strokeOpacity:0.8,
                strokeWeight: 2,
                fillColor: "red"
            });

            return circle;
          }

          function createMarker(index) {

             // function markerFilter(marker){
             //    if (requests[index].category == 'relief') {
             //      marker.setMap(null);
             //      marker = null;
             //    }
             //  };



            var marker = new google.maps.Marker({
              position: requests[index].position,
              icon: icons[requests[index].category].icon, //CHANGE ICONS HERE
              map: map,
              id: requests[index].id,
              user_id: requests[index].user_id,
              category: requests[index].category, // GOING TO BE ITEM
              address: requests[index].address,
              priority: requests[index].priority,
              status: requests[index].status,
              created_at: requests[index].created_at,
              updated_at: requests[index].updated_at,

              // label: labels[i % labels.length]
            });

            map.circles.push(createCircle(marker));
            // console.log(marker.map);
// var map = map;


             // circle.bindTo('center',marker[index],'position');

            //  function getCustomRadiusForZoom(zoomLevel) {
            //     switch (true) {
            //         case (zoomLevel < 10 && zoomLevel > 5):
            //             return 30;
            //         case (zoomLevel <= 5 && zoomLevel > 1):
            //             return 15;
            //         case (zoomLevel <= 1):
            //             return 5;
            //     }
            //     return radius;
            //   };

            //  google.maps.event.addListener(map, 'zoom_changed', function() {
            //   var zoomLevel = map.getZoom();
            //   circle.setRadius(getCustomRadiusForZoom(zoomLevel));
            // });


              function displayEachData() {

                  // pass this as params[:data_value] in controller

                $('#results').html('<p class="results-text">' + 'ID:  ' + marker.id + '</p>' + '<p class="results-text">' + 'Category:  ' + marker.category + '</p>'
                  + '<p class="results-text">' + 'Address:  ' + marker.address + '</p>'
                  + '<p class="results-text">' + 'Priority:  ' + marker.priority + '</p>'
                  + '<p class="results-text">' + 'Status:  ' + marker.status + '</p>'
                  + '<p class="results-text">' + 'Created at:  ' + marker.created_at + '</p>'
                  + '<p class="results-text">' + 'Updated at:  ' + marker.updated_at + '</p>'
                  // + '<%#= button_to "Show Details", user_request_path(' + marker.user_id + ', ' + marker.id + '), class: 'btn btn-primary' %>'
                  + '<a href="/users/' + marker.user_id + '/requests/' + marker.id + '" class="btn btn-primary"> Show Details </a>'
                  )};
                // end of displayEachData


            marker.addListener('click', function(){

              displayEachData();

               $('#results').toggle()
            });
            // end of addListener click

            return marker;
   }
    // end of createMarker

      for (i = 0; i < requests.length; i++) {
        map.markers.push(createMarker(i));
      }
      // end of for loop
      // var markerCluster = new MarkerClusterer(map, map.markers,
      //       {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
      // this is for clustering.. need to load marketclusterer

  // console.log(markers.map)


        // console.log(markers);
        // callback();
        callback();
      }
       // end of init map

        var filtersHash = {food:false, water:false, clothing:false, blankets:false, tents:false, firstaid:false, drivers:false, heavy:false, general:false, fire:false, medical:false, rescue:false }
        //set initial value of checkboxes

        function filterMarkers(hash) {

          for (i = 0; i < map.markers.length; i++) {

            var marker = map.markers[i].category; //

            console.log(marker);

            if ( hash[marker] == true ) {
              // map.markers[i].setMap(null);
              // map.circles[0].setVisible(false);
              // markers[0].setVisible(false);
              // delete map.markers[i];
             // delete map.circles[0];
          console.log("true");

          } else {

            // map.markers[i].setMap(map);
            console.log("false");

          };
        };
      };
        //end of filterMarkers

      function onFilterChange() {
       $('input[name=filter]').change(function () {
        var changedBox = $(this).attr('value');
        filtersHash[changedBox] = !filtersHash[changedBox];
        // console.log(changedBox);
        // console.log(filtersHash[changedBox]);
         filterMarkers(filtersHash);

        });
      };
      // get value of checkbox



      // function onFilterChange() {
      //   $('input[name=filter]').change(function () {
      //     var changedBoxClick = $(this).attr('value');
      //     filterMarkers();
      //   // console.log(changedBoxClick);

      //   });
      // };



        // map.markers[0].setMap(null);
        // // map.circles[0].setVisible(false);
        // // markers[0].setVisible(false);
        // delete map.markers[0];
        // delete map.circles[0];


      // initMap(consoleMarkers);
      // initMap(filterMarkers);
      initMap(onFilterChange);
      // filterMarkers();


      // getFiltersHash();
      // gets hash indicating which filters are checked


      </script>
      <!-- end of map script -->

      <%#= javascript_include_tag "https://maps.googleapis.com/maps/api/js?language=en&key=#{ENV['GOOGLE_API_BROWSER_KEY']}&callback=initMap" %>

      <!-- <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=[key]&callback=initMap">
      </script> -->

      <%#= javascript_include_tag "https://maps.google.com/maps/api/js?libraries=places&key=#{ENV['GOOGLE_API_BROWSER_KEY']}" %>

      <script>

        $(document).ready(function() {
          $("#results").hide();
        });

      </script>

      <script>
       function toggleChevron(e) {
        $(e.target)
        .prev('.panel-heading')
        .find("i.indicator")
        .toggleClass('fa-caret-down fa-caret-right');
        }
        $('#accordion').on('hidden.bs.collapse', toggleChevron);
        $('#accordion').on('shown.bs.collapse', toggleChevron);
      </script>
    </script>
    <% end %>
